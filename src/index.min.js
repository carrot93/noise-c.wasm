(function(){var e;function t(c,f){var l,i;function u(e,t){var n,s;return n=i(),c._NoiseBuffer_create(n,e,t,e.length),s=n.dereference(),n.free(),s}function d(e,t){var n,s;if(e!==f.NOISE_ERROR_NONE)for(n in s=f)if(s[n]===e){if(t)try{t.free()}catch(e){}throw new Error(n)}}function n(e){var t;if(!(this instanceof n))return new n(e);t=i(),d(c._noise_cipherstate_new_by_id(t,e),t),this._state=t.dereference(),this._mac_length=c._noise_cipherstate_get_mac_length(this._state),t.free()}function a(e){this._state=e,this._mac_length=c._noise_cipherstate_get_mac_length(this._state)}function s(e){var t,n=this;if(!(this instanceof s))return new s(e);t=i(),e=l(0,e),d(c._noise_symmetricstate_new_by_name(t,e),t),this._state=t.dereference(),t.free(),e.free(),Object.defineProperty(this,"_mac_length",{configurable:!0,get:function(){var e;return 0<(e=c._noise_symmetricstate_get_mac_length(n._state))&&(n._mac_length=e),e}})}function r(e,t){var n,s;if(!(this instanceof r))return new r(e,t);n=i(),e=l(0,e),s=c._noise_handshakestate_new_by_name(n,e,t),e.free(),d(s,n),this._state=n.dereference(),n.free()}return(c=c())._random_bytes=e,l=c.allocateBytes,i=c.allocatePointer,n.prototype={InitializeKey:function(e){var t;e=l(0,e),t=c._noise_cipherstate_init_key(this._state,e,e.length),e.free(),d(t,this)},HasKey:function(){return 1===c._noise_cipherstate_has_key(this._state)},SetNonce:function(e){d(c._noise_cipherstate_set_nonce(this._state,e),this)},EncryptWithAd:function(e,t){var n,s,r;return e=l(0,e),n=u(t=l(t.length+this._mac_length,t),t.length-this._mac_length),s=c._noise_cipherstate_encrypt_with_ad(this._state,e,e.length,n),r=t.get(),e.free(),t.free(),n.free(),d(s),r},DecryptWithAd:function(e,t){var n,s,r;return e=l(0,e),n=u(t=l(0,t),t.length),s=c._noise_cipherstate_decrypt_with_ad(this._state,e,e.length,n),r=t.get().slice(0,t.length-this._mac_length),e.free(),t.free(),n.free(),d(s),r},Rekey:function(){throw"Not implemented"},free:function(){var e;e=c._noise_cipherstate_free(this._state),delete this._state,delete this._mac_length,d(e)}},Object.defineProperty(n.prototype,"constructor",{enumerable:!1,value:n}),a.prototype=Object.create(n.prototype),Object.defineProperty(a.prototype,"constructor",{enumerable:!1,value:a}),s.prototype={MixKey:function(e){var t;e=l(0,e),t=c._noise_symmetricstate_mix_key(this._state,e,e.length),e.free(),d(t,this)},MixHash:function(e){var t;e=l(0,e),t=c._noise_symmetricstate_mix_hash(this._state,e,e.length),e.free(),d(t,this)},MixKeyAndHash:function(e){var t,n,s,r;this.MixKey(e),t=i(),n=c._SymmetricState_get_ck(this._state,t),s=t.dereference(n),t.free(),r=s.get(),s.free(),this.MixHash(r)},EncryptAndHash:function(e){var t,n,s;return t=u(e=l(e.length+this._mac_length,e),e.length-this._mac_length),n=c._noise_symmetricstate_encrypt_and_hash(this._state,t),s=e.get(),e.free(),t.free(),d(n,this),s},DecryptAndHash:function(e){var t,n,s;return t=u(e=l(0,e),e.length),n=c._noise_symmetricstate_decrypt_and_hash(this._state,t),s=e.get().slice(0,e.length-this._mac_length),e.free(),t.free(),d(n,this),s},Split:function(){var t,n,e,s,r,_;t=i(),n=i(),e=c._noise_symmetricstate_split(this._state,t,n);try{d(e)}catch(e){throw s=e,t.free(),n.free(),s}r=new a(t.dereference()),_=new a(n.dereference()),t.free(),n.free();try{this.free()}catch(e){s=e;try{r.free()}catch(e){}try{_.free()}catch(e){}throw s}return[r,_]},free:function(){var e;e=c._noise_symmetricstate_free(this._state),delete this._state,delete this._mac_length,d(e)}},Object.defineProperty(s.prototype,"constructor",{enumerable:!1,value:s}),r.prototype={Initialize:function(e,t,n,s){var r,_;if(null==e&&(e=null),null==t&&(t=null),null==n&&(n=null),null==s&&(s=null),e&&(e=l(0,e),r=c._noise_handshakestate_set_prologue(this._state,e,e.length),e.free(),d(r,this)),s&&1===c._noise_handshakestate_needs_pre_shared_key(this._state)&&(s=l(0,s),r=c._noise_handshakestate_set_pre_shared_key(this._state,s,s.length),s.free(),d(r,this)),1===c._noise_handshakestate_needs_local_keypair(this._state)){if(!t)throw new Error("Local static private key (s) required, but not provided");_=c._noise_handshakestate_get_local_keypair_dh(this._state),t=l(0,t),r=c._noise_dhstate_set_keypair_private(_,t,t.length),t.free(),d(r,this)}if(1===c._noise_handshakestate_needs_remote_public_key(this._state)){if(!n)throw new Error("Remote static public key (rs) required, but not provided");_=c._noise_handshakestate_get_remote_public_key_dh(this._state),n=l(0,n),r=c._noise_dhstate_set_public_key(_,n,n.length),n.free(),d(r,this)}d(r=c._noise_handshakestate_start(this._state),this)},GetAction:function(){return c._noise_handshakestate_get_action(this._state)},FallbackTo:function(e){null==e&&(e=f.NOISE_PATTERN_XX_FALLBACK),d(c._noise_handshakestate_fallback_to(this._state,e),this)},WriteMessage:function(e){var t,n,s,r,_,i,a;null==e&&(e=null),n=u(t=l(f.NOISE_MAX_PAYLOAD_LEN),0),s=null,e&&(s=u(e=l(0,e),e.length)),r=c._noise_handshakestate_write_message(this._state,n,s),e&&(e.free(),s.free());try{d(r,this)}catch(e){throw _=e,t.free(),n.free(),_}return i=c._NoiseBuffer_get_size(n),a=t.get().slice(0,i),t.free(),n.free(),a},ReadMessage:function(e,t,n){var s,r,_,i,a,h,o;null==t&&(t=!1),null==n&&(n=!1),s=u(e=l(0,e),e.length),r=null,t&&(r=u(_=l(f.NOISE_MAX_PAYLOAD_LEN),_.length)),i=c._noise_handshakestate_read_message(this._state,s,r),e.free(),s.free();try{d(i,n?void 0:this)}catch(e){throw a=e,t&&(_.free(),r.free()),a}return h=null,t&&(o=c._NoiseBuffer_get_size(r),h=_.get().slice(0,o),_.free(),r.free()),h},Split:function(){var t,n,e,s,r,_;t=i(),n=i(),e=c._noise_handshakestate_split(this._state,t,n);try{d(e,this)}catch(e){throw s=e,t.free(),n.free(),s}r=new a(t.dereference()),_=new a(n.dereference()),t.free(),n.free();try{this.free()}catch(e){s=e;try{r.free()}catch(e){}try{_.free()}catch(e){}throw s}return[r,_]},free:function(){var e;e=c._noise_handshakestate_free(this._state),delete this._state,d(e)}},Object.defineProperty(r.prototype,"constructor",{enumerable:!1,value:r}),{ready:c.then,constants:f,CipherState:n,SymmetricState:s,HandshakeState:r,_lib_internal:c}}e="undefined"!=typeof crypto?function(e){var t;return t=new Uint8Array(e),crypto.getRandomValues(t),t}:require("crypto").randomBytes,"function"==typeof define&&define.amd?define(["./noise-c","./constants"],t):"object"==typeof exports?module.exports=t(require("./noise-c"),require("./constants")):this.noise_c_wasm=t(this.__noise_c_wasm,this.__noise_c_wasm_constants)}).call(this);