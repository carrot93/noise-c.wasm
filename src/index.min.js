(function(){var o;function e(e,t){return function(c,f,e,t){var _,s,l,u;if(_="function"==typeof e?{}:e,"function"!=typeof(s=t||e))throw new TypeError("noise-c.wasm: Callback is not a function");function d(e,t){var _,s;return _=u(),c._NoiseBuffer_create(_,e,t,e.length),s=_.dereference(),_.free(),s}function y(e,t){var _,s;if(e!==f.NOISE_ERROR_NONE)for(_ in s=f)if(s[_]===e){if(t)try{t.free()}catch(e){}throw new Error(_)}}function n(e){var t,_,s,n,r,i,a,h,o;if(e===f.NOISE_DH_CURVE448||e===f.NOISE_DH_CURVE25519){t=u(),y(_=c._noise_dhstate_new_by_id(t,e),t),s=t.dereference(),t.free(),_=c._noise_dhstate_generate_keypair(s);try{y(_)}catch(e){throw n=e,c._noise_dhstate_free(s),n}a=i=r=null,_=e===f.NOISE_DH_CURVE448?(a="curve448",r=l(56),i=l(56),c._noise_dhstate_get_keypair(s,r,56,i,56)):(a="curve25519",r=l(32),i=l(32),c._noise_dhstate_get_keypair(s,r,32,i,32)),c._noise_dhstate_free(s),o=h=null;try{y(_),h=r.get(),r.free(),o=i.get(),i.free()}catch(e){throw n=e,r.free(),i.free(),n}return{keyType:a,privateKey:h,publicKey:o}}}function r(e){var t;if(!(this instanceof r))return new r(e);t=u(),y(c._noise_cipherstate_new_by_id(t,e),t),this._state=t.dereference(),this._mac_length=c._noise_cipherstate_get_mac_length(this._state),t.free()}function i(e){this._state=e,this._mac_length=c._noise_cipherstate_get_mac_length(this._state)}function a(e){var t,_=this;if(!(this instanceof a))return new a(e);t=u(),e=l(0,e),y(c._noise_symmetricstate_new_by_name(t,e),t),this._state=t.dereference(),t.free(),e.free(),Object.defineProperty(this,"_mac_length",{configurable:!0,get:function(){var e;return 0<(e=c._noise_symmetricstate_get_mac_length(_._state))&&(_._mac_length=e),e}})}function h(e,t){var _,s;if(!(this instanceof h))return new h(e,t);_=u(),e=l(0,e),s=c._noise_handshakestate_new_by_name(_,e,t),e.free(),y(s,_),this._state=_.dereference(),_.free()}(c=c(_))._random_bytes=o,l=c.allocateBytes,u=c.allocatePointer,r.prototype={InitializeKey:function(e){var t;e=l(0,e),t=c._noise_cipherstate_init_key(this._state,e,e.length),e.free(),y(t,this)},HasKey:function(){return 1===c._noise_cipherstate_has_key(this._state)},SetNonce:function(e){y(c._noise_cipherstate_set_nonce(this._state,e),this)},EncryptWithAd:function(e,t){var _,s,n;return e=l(0,e),_=d(t=l(t.length+this._mac_length,t),t.length-this._mac_length),s=c._noise_cipherstate_encrypt_with_ad(this._state,e,e.length,_),n=t.get(),e.free(),t.free(),_.free(),y(s),n},DecryptWithAd:function(e,t){var _,s,n;return e=l(0,e),_=d(t=l(0,t),t.length),s=c._noise_cipherstate_decrypt_with_ad(this._state,e,e.length,_),n=t.get().slice(0,t.length-this._mac_length),e.free(),t.free(),_.free(),y(s),n},Rekey:function(){throw"Not implemented"},free:function(){var e;e=c._noise_cipherstate_free(this._state),delete this._state,delete this._mac_length,y(e)}},Object.defineProperty(r.prototype,"constructor",{enumerable:!1,value:r}),i.prototype=Object.create(r.prototype),Object.defineProperty(i.prototype,"constructor",{enumerable:!1,value:i}),a.prototype={MixKey:function(e){var t;e=l(0,e),t=c._noise_symmetricstate_mix_key(this._state,e,e.length),e.free(),y(t,this)},MixHash:function(e){var t;e=l(0,e),t=c._noise_symmetricstate_mix_hash(this._state,e,e.length),e.free(),y(t,this)},MixKeyAndHash:function(e){var t,_,s,n;this.MixKey(e),t=u(),_=c._SymmetricState_get_ck(this._state,t),s=t.dereference(_),t.free(),n=s.get(),s.free(),this.MixHash(n)},EncryptAndHash:function(e){var t,_,s;return t=d(e=l(e.length+this._mac_length,e),e.length-this._mac_length),_=c._noise_symmetricstate_encrypt_and_hash(this._state,t),s=e.get(),e.free(),t.free(),y(_,this),s},DecryptAndHash:function(e){var t,_,s;return t=d(e=l(0,e),e.length),_=c._noise_symmetricstate_decrypt_and_hash(this._state,t),s=e.get().slice(0,e.length-this._mac_length),e.free(),t.free(),y(_,this),s},Split:function(){var t,_,e,s,n,r;t=u(),_=u(),e=c._noise_symmetricstate_split(this._state,t,_);try{y(e)}catch(e){throw s=e,t.free(),_.free(),s}n=new i(t.dereference()),r=new i(_.dereference()),t.free(),_.free();try{this.free()}catch(e){s=e;try{n.free()}catch(e){}try{r.free()}catch(e){}throw s}return[n,r]},free:function(){var e;e=c._noise_symmetricstate_free(this._state),delete this._state,delete this._mac_length,y(e)}},Object.defineProperty(a.prototype,"constructor",{enumerable:!1,value:a}),h.prototype={Initialize:function(e,t,_,s){var n,r;if(null==e&&(e=null),null==t&&(t=null),null==_&&(_=null),null==s&&(s=null),e&&(e=l(0,e),n=c._noise_handshakestate_set_prologue(this._state,e,e.length),e.free(),y(n,this)),s&&1===c._noise_handshakestate_needs_pre_shared_key(this._state)&&(s=l(0,s),n=c._noise_handshakestate_set_pre_shared_key(this._state,s,s.length),s.free(),y(n,this)),1===c._noise_handshakestate_needs_local_keypair(this._state)){if(!t)throw new Error("Local static private key (s) required, but not provided");r=c._noise_handshakestate_get_local_keypair_dh(this._state),t=l(0,t),n=c._noise_dhstate_set_keypair_private(r,t,t.length),t.free(),y(n,this)}if(1===c._noise_handshakestate_needs_remote_public_key(this._state)){if(!_)throw new Error("Remote static public key (rs) required, but not provided");r=c._noise_handshakestate_get_remote_public_key_dh(this._state),_=l(0,_),n=c._noise_dhstate_set_public_key(r,_,_.length),_.free(),y(n,this)}y(n=c._noise_handshakestate_start(this._state),this)},GetAction:function(){return c._noise_handshakestate_get_action(this._state)},FallbackTo:function(e){null==e&&(e=f.NOISE_PATTERN_XX_FALLBACK),y(c._noise_handshakestate_fallback_to(this._state,e),this)},WriteMessage:function(e){var t,_,s,n,r,i,a;null==e&&(e=null),_=d(t=l(f.NOISE_MAX_PAYLOAD_LEN),0),s=null,e&&(s=d(e=l(0,e),e.length)),n=c._noise_handshakestate_write_message(this._state,_,s),e&&(e.free(),s.free());try{y(n,this)}catch(e){throw r=e,t.free(),_.free(),r}return i=c._NoiseBuffer_get_size(_),a=t.get().slice(0,i),t.free(),_.free(),a},ReadMessage:function(e,t,_){var s,n,r,i,a,h,o;null==t&&(t=!1),null==_&&(_=!1),s=d(e=l(0,e),e.length),n=null,t&&(n=d(r=l(f.NOISE_MAX_PAYLOAD_LEN),r.length)),i=c._noise_handshakestate_read_message(this._state,s,n),e.free(),s.free();try{y(i,_?void 0:this)}catch(e){throw a=e,t&&(r.free(),n.free()),a}return h=null,t&&(o=c._NoiseBuffer_get_size(n),h=r.get().slice(0,o),r.free(),n.free()),h},Split:function(){var t,_,e,s,n,r;t=u(),_=u(),e=c._noise_handshakestate_split(this._state,t,_);try{y(e,this)}catch(e){throw s=e,t.free(),_.free(),s}n=new i(t.dereference()),r=new i(_.dereference()),t.free(),_.free();try{this.free()}catch(e){s=e;try{n.free()}catch(e){}try{r.free()}catch(e){}throw s}return[n,r]},GetHandshakeHash:function(){var t,e,_,s,n;t=u(),e=c._noise_handshakestate_get_protocol_id(this._state,t);try{y(e,this)}catch(e){throw _=e,t.free(),_}s=null,e=c._NoiseProtocolId_get_hash_id(t)===f.NOISE_HASH_BLAKE2b||c._NoiseProtocolId_get_hash_id(t)===f.NOISE_HASH_SHA512?(s=l(64),c._noise_handshakestate_get_handshake_hash(this._state,s,64)):(s=l(32),c._noise_handshakestate_get_handshake_hash(this._state,s,32)),t.free(),n=null;try{y(e,this),n=s.get(),s.free()}catch(e){throw _=e,s.free(),_}return n},GetRemotePublicKey:function(){var e,t,_,s,n;if(0!==c._noise_handshakestate_has_remote_public_key(this._state)&&(e=c._noise_handshakestate_get_remote_public_key_dh(this._state),t=null,_=c._noise_dhstate_get_dh_id(e)===f.NOISE_DH_CURVE448?(t=l(56),c._noise_dhstate_get_public_key(e,hash_buffer,56)):c._noise_dhstate_get_dh_id(e)===f.NOISE_DH_CURVE25519?(t=l(32),c._noise_dhstate_get_public_key(e,hash_buffer,32)):f.NOISE_ERROR_UNKNOWN_ID,null!==t)){s=null;try{y(_,this),s=t.get(),t.free()}catch(e){throw n=e,t.free(),n}return s}},free:function(){var e;e=c._noise_handshakestate_free(this._state),delete this._state,y(e)}},Object.defineProperty(h.prototype,"constructor",{enumerable:!1,value:h}),c.then(function(){s({constants:f,CipherState:r,SymmetricState:a,HandshakeState:h,CreateKeyPair:n,_lib_internal:c})})}.bind(this,e,t)}o="undefined"!=typeof crypto?function(e){var t;return t=new Uint8Array(e),crypto.getRandomValues(t),t}:require("crypto").randomBytes,"function"==typeof define&&define.amd?define(["./noise-c","./constants"],e):"object"==typeof exports?module.exports=e(require("./noise-c"),require("./constants")):this.noise_c_wasm=e(this.__noise_c_wasm,this.__noise_c_wasm_constants)}).call(this);